services:
  gateway:
    build: ./gateway
    container_name: desafio5-gateway
    ports:
      - "8080:8080"  
    environment:
      - RECORDS_SERVICE_URL=http://records-service:5001
      - RENTALS_SERVICE_URL=http://rentals-service:5002
    depends_on:
      records-service:
        condition: service_healthy
      rentals-service:
        condition: service_healthy
    networks:
      - desafio5-network

  records-service:
    build: ./records-service
    container_name: desafio5-records
    expose:
      - "5001"
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5001/health')"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    networks:
      - desafio5-network

  rentals-service:
    build: ./rentals-service
    container_name: desafio5-rentals
    expose:
      - "5002"
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5002/health')"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    networks:
      - desafio5-network

networks:
  desafio5-network:
    driver: bridge
